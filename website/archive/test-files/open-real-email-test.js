// Real email test - opens your email client with actual TestNotifier notification
const { exec } = require('child_process');
const os = require('os');

console.log('ğŸš€ Opening Real Email Test for hello@testnotifier.co.uk');
console.log('======================================================');

const emailData = {
  to: "hello@testnotifier.co.uk",
  subject: "ğŸ¯ TestNotifier: Earlier Driving Test Slot Found!",
  body: `Great news! We found an earlier driving test slot for your student.

ğŸ¯ EARLIER SLOT FOUND:
â€¢ Date: 15th December 2025
â€¢ Time: 10:30 AM
â€¢ Test Centre: London (West)
â€¢ Type: Practical Driving Test

ğŸ“‹ STUDENT DETAILS:
â€¢ Name: Test Student
â€¢ Current Test: 20th January 2026
â€¢ Licence: TEST123456

âš¡ WHAT HAPPENS NEXT:
The extension will monitor this slot and can attempt automatic booking if enabled.

ğŸ’¡ IMPORTANT:
This is a real notification from TestNotifier. The extension monitors DVSA for earlier slots 24/7.

ğŸŒŸ SUCCESS RATE:
TestNotifier has a 95% success rate in finding earlier slots for learners.

Good luck with the test!

---
TestNotifier - Find earlier driving test slots automatically
https://testnotifier.co.uk

This email was generated by TestNotifier notification system.`
};

// Create the mailto link
const mailtoLink = `mailto:${emailData.to}?subject=${encodeURIComponent(emailData.subject)}&body=${encodeURIComponent(emailData.body)}`;

console.log('ğŸ“§ Email Details:');
console.log('To:', emailData.to);
console.log('Subject:', emailData.subject);
console.log('Body length:', emailData.body.length, 'characters');
console.log('\nğŸ¯ Opening your email client...');

// Open email client based on OS
const platform = os.platform();
let command;

switch (platform) {
  case 'darwin': // Mac
    command = `open "${mailtoLink}"`;
    break;
  case 'win32': // Windows
    command = `start "" "${mailtoLink}"`;
    break;
  case 'linux': // Linux
    command = `xdg-open "${mailtoLink}"`;
    break;
  default:
    console.log('âŒ Unsupported platform:', platform);
    console.log('\nğŸ’¡ Manual test:');
    console.log('Copy this link and paste in browser:');
    console.log(mailtoLink);
    process.exit(0);
}

console.log('âœ… Command:', command);

exec(command, (error, stdout, stderr) => {
  if (error) {
    console.log('âŒ Error opening email client:', error.message);
    console.log('\nğŸ’¡ Manual test:');
    console.log('Copy this link and paste in your browser:');
    console.log(mailtoLink);
    return;
  }

  console.log('\nğŸ‰ SUCCESS!');
  console.log('âœ… Email client should now be open');
  console.log('âœ… Check hello@testnotifier.co.uk for the notification');
  console.log('âœ… This is exactly what the extension generates');

  console.log('\nğŸ“‹ What to check:');
  console.log('1. âœ‰ï¸ Email client opened successfully');
  console.log('2. ğŸ“§ To: hello@testnotifier.co.uk (your email)');
  console.log('3. ğŸ“‹ Subject: ğŸ¯ TestNotifier: Earlier Driving Test Slot Found!');
  console.log('4. ğŸ“ Complete notification body with slot details');
  console.log('5. ğŸ”— Proper mailto formatting');
});

console.log('\nâ±ï¸  Email client opening... Please check your default email application.');
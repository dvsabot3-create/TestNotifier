/*! For license information please see popup.js.LICENSE.txt */
(()=>{function e(t){return e='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e;}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e;},e(t);}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable;})),n.push.apply(n,r);}return n;}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach(function(t){r(e,t,i[t]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t));});}return e;}function r(e,t,n){return(t=u(t))in e?Object.defineProperty(e,t,{ value:n,enumerable:!0,configurable:!0,writable:!0 }):e[t]=n,e;}function i(){var e,t,n='function'==typeof Symbol?Symbol:{},r=n.iterator||'@@iterator',s=n.toStringTag||'@@toStringTag';function a(n,r,i,s){var a=r&&r.prototype instanceof u?r:u,l=Object.create(a.prototype);return o(l,'_invoke',function(n,r,i){var o,s,a,u=0,l=i||[],p=!1,d={ p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return o=t,s=0,a=e,d.n=n,c;} };function f(n,r){for(s=n,a=r,t=0;!p&&u&&!i&&t<l.length;t++){var i,o=l[t],f=d.p,h=o[2];n>3?(i=h===r)&&(a=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=f&&((i=n<2&&f<o[1])?(s=0,d.v=r,d.n=o[1]):f<h&&(i=n<3||o[0]>r||r>h)&&(o[4]=n,o[5]=r,d.n=h,s=0));}if(i||n>1)return c;throw p=!0,r;}return function(i,l,h){if(u>1)throw TypeError('Generator is already running');for(p&&1===l&&f(l,h),s=l,a=h;(t=s<2?e:a)||!p;){o||(s?s<3?(s>1&&(d.n=-1),f(s,a)):d.n=a:d.v=a);try{if(u=2,o){if(s||(i='next'),t=o[i]){if(!(t=t.call(o,a)))throw TypeError('iterator result is not an object');if(!t.done)return t;a=t.value,s<2&&(s=0);}else 1===s&&(t=o.return)&&t.call(o),s<2&&(a=TypeError('The iterator does not provide a \''+i+'\' method'),s=1);o=e;}else if((t=(p=d.n<0)?a:n.call(r,d))!==c)break;}catch(t){o=e,s=1,a=t;}finally{u=1;}}return{ value:t,done:p };};}(n,i,s),!0),l;}var c={};function u(){}function l(){}function p(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(o(t={},r,function(){return this;}),t),f=p.prototype=u.prototype=Object.create(d);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,o(e,s,'GeneratorFunction')),e.prototype=Object.create(f),e;}return l.prototype=p,o(f,'constructor',p),o(p,'constructor',l),l.displayName='GeneratorFunction',o(p,s,'GeneratorFunction'),o(f),o(f,s,'Generator'),o(f,r,function(){return this;}),o(f,'toString',function(){return'[object Generator]';}),(i=function(){return{ w:a,m:h };})();}function o(e,t,n,r){var i=Object.defineProperty;try{i({},'',{});}catch(e){i=0;}o=function(e,t,n,r){function s(t,n){o(e,t,function(e){return this._invoke(t,n,e);});}t?i?i(e,t,{ value:n,enumerable:!r,configurable:!r,writable:!r }):e[t]=n:(s('next',0),s('throw',1),s('return',2));},o(e,t,n,r);}function s(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value;}catch(e){return void n(e);}a.done?t(c):Promise.resolve(c).then(r,i);}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){s(o,r,i,a,c,'next',e);}function c(e){s(o,r,i,a,c,'throw',e);}a(void 0);});};}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r);}}function u(t){var n=function(t){if('object'!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,'string');if('object'!=e(r))return r;throw new TypeError('@@toPrimitive must return a primitive value.');}return String(t);}(t);return'symbol'==e(n)?n:n+'';}var l=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function');}(this,e),this.currentInstructor=null,this.pupils=[],this.settings={ autoCheck:!0,soundEnabled:!0,notifications:!0 },this.isInitialized=!1;},t=[{ key:'initialize',value:(g=a(i().m(function e(){return i().w(function(e){for(;;)switch(e.n){case 0:return console.log('üöÄ Initializing popup...'),e.n=1,this.loadSettings();case 1:return e.n=2,this.loadExtensionState();case 2:this.setupEventListeners(),this.updateUI(),console.log('‚úÖ Popup initialized');case 3:return e.a(2);}},e,this);})),function(){return g.apply(this,arguments);}) },{ key:'loadSettings',value:(h=a(i().m(function e(){var t,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.runtime.sendMessage({ action:'getSettings' });case 1:(t=e.v).success&&(this.settings=n(n({},this.settings),t.settings),console.log('‚úÖ Settings loaded:',this.settings)),e.n=3;break;case 2:e.p=2,r=e.v,console.error('‚ùå Error loading settings:',r);case 3:return e.a(2);}},e,this,[[0,2]]);})),function(){return h.apply(this,arguments);}) },{ key:'loadExtensionState',value:(f=a(i().m(function e(){var t,n,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.runtime.sendMessage({ action:'getState' });case 1:(t=e.v).success&&(n=t.state,this.currentInstructor=n.currentInstructor,this.pupils=n.pupils||[],console.log('‚úÖ Extension state loaded:',{ instructor:this.currentInstructor,pupils:this.pupils.length })),e.n=3;break;case 2:e.p=2,r=e.v,console.error('‚ùå Error loading extension state:',r);case 3:return e.a(2);}},e,this,[[0,2]]);})),function(){return f.apply(this,arguments);}) },{ key:'setupEventListeners',value:function(){var e=this,t=document.getElementById('setup-instructor');t&&t.addEventListener('click',function(){return e.setupInstructor();});var n=document.getElementById('add-pupil');n&&n.addEventListener('click',function(){return e.addPupil();});var r=document.getElementById('manual-check');r&&r.addEventListener('click',function(){return e.manualCheck();});var i=document.getElementById('open-options');i&&i.addEventListener('click',function(){return e.openOptions();}),this.setupSettingsToggles();var o=document.getElementById('save-settings');o&&o.addEventListener('click',function(){return e.saveSettings();}),this.setupInputValidation();} },{ key:'setupInstructor',value:(d=a(i().m(function e(){var t,n,r,o,s,a,c=this;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log('üìù Setting up instructor...'),t=document.getElementById('adi-number').value.trim(),n=document.getElementById('base-location').value.trim(),r=parseInt(document.getElementById('travel-radius').value)||50,t&&n){e.n=1;break;}return this.showError('Please fill in all required fields'),e.a(2);case 1:if(/^ADI\d{6}$/i.test(t)){e.n=2;break;}return this.showError('ADI number must be in format ADI123456'),e.a(2);case 2:if(!(r<10||r>100)){e.n=3;break;}return this.showError('Travel radius must be between 10-100km'),e.a(2);case 3:return e.p=3,this.showLoading('Setting up instructor...'),o={ adiNumber:t.toUpperCase(),name:'Instructor '+t.slice(3),baseLocation:{ city:n,postcode:'SW1A 1AA',lat:51.5074,lon:-.1278 },travelRadius:r,phone:'+447700900123',email:'instructor@example.com' },e.n=4,chrome.runtime.sendMessage({ action:'setupInstructor',data:o });case 4:(s=e.v).success?(this.currentInstructor=s.instructor,this.showSuccess('Instructor setup successful!'),this.updateUI(),setTimeout(function(){return c.startMonitoring();},1e3)):this.showError(s.error||'Setup failed'),e.n=6;break;case 5:e.p=5,a=e.v,console.error('‚ùå Error setting up instructor:',a),this.showError('Setup failed: '+a.message);case 6:return e.p=6,this.hideLoading(),e.f(6);case 7:return e.a(2);}},e,this,[[3,5,6,7]]);})),function(){return d.apply(this,arguments);}) },{ key:'addPupil',value:(p=a(i().m(function e(){var t,n,r,o,s;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log('‚ûï Adding new pupil...'),t=document.getElementById('new-pupil-licence'),n=t.value.trim()){e.n=1;break;}return this.showError('Please enter pupil licence number'),e.a(2);case 1:if(/^[A-Z]{2}\d{6}[A-Z]$/i.test(n)){e.n=2;break;}return this.showError('Licence must be in format: XX123456X (e.g., SMITH123456S)'),e.a(2);case 2:if(!this.pupils.some(function(e){return e.licence.toUpperCase()===n.toUpperCase();})){e.n=3;break;}return this.showError('Pupil already exists'),e.a(2);case 3:return e.p=3,r={ licence:n.toUpperCase(),name:n.slice(0,-1),phone:'+447700900456',centres:['LONDON-WD','LONDON-WG'],earliest:new Date(Date.now()+6048e5).toISOString().split('T')[0],latest:new Date(Date.now()+7776e6).toISOString().split('T')[0],status:'QUEUED' },e.n=4,chrome.runtime.sendMessage({ action:'addPupil',data:r });case 4:(o=e.v).success?(this.pupils.push(r),t.value='',this.renderPupilsList(),this.showSuccess('Pupil added successfully!')):this.showError(o.error||'Failed to add pupil'),e.n=6;break;case 5:e.p=5,s=e.v,console.error('‚ùå Error adding pupil:',s),this.showError('Failed to add pupil: '+s.message);case 6:return e.a(2);}},e,this,[[3,5]]);})),function(){return p.apply(this,arguments);}) },{ key:'renderPupilsList',value:function(){var e=document.getElementById('pupils-list');e&&(0!==this.pupils.length?e.innerHTML=this.pupils.map(function(e){return'\n      <div class="pupil-item">\n        <div class="pupil-info">\n          <div class="pupil-name">'.concat(e.name,'</div>\n          <div class="pupil-licence">').concat(e.licence,'</div>\n        </div>\n        <div class="pupil-status ').concat(e.status.toLowerCase(),'">').concat(e.status,'</div>\n      </div>\n    ');}).join(''):e.innerHTML='\n        <div class="empty-state">\n          <div class="empty-state-icon">üë•</div>\n          <div class="empty-state-text">No pupils added yet</div>\n        </div>\n      ');} },{ key:'manualCheck',value:(l=a(i().m(function e(){var t,n;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log('üîÑ Manual check requested'),this.currentInstructor){e.n=1;break;}return this.showError('Please set up instructor first'),e.a(2);case 1:return this.showLoading('Checking for cancellations...'),e.p=2,e.n=3,chrome.runtime.sendMessage({ action:'manualCheck',data:{ instructorId:this.currentInstructor.adiNumber } });case 3:(t=e.v).success?this.showSuccess('Check completed successfully'):this.showError(t.error||'Check failed'),e.n=5;break;case 4:e.p=4,n=e.v,console.error('‚ùå Error during manual check:',n),this.showError('Check failed: '+n.message);case 5:return e.p=5,this.hideLoading(),e.f(5);case 6:return e.a(2);}},e,this,[[2,4,5,6]]);})),function(){return l.apply(this,arguments);}) },{ key:'setupSettingsToggles',value:function(){var e=this;[{ id:'auto-check-toggle',setting:'autoCheck' },{ id:'sound-toggle',setting:'soundEnabled' },{ id:'notifications-toggle',setting:'notifications' }].forEach(function(t){var n=t.id,r=t.setting,i=document.getElementById(n);i&&e.setupToggleSwitch(i,r);});} },{ key:'setupToggleSwitch',value:function(e,t){var n=this,o=this.settings[t];e.classList.toggle('active',o),e.addEventListener('click',a(i().m(function o(){var s,a;return i().w(function(i){for(;;)switch(i.p=i.n){case 0:return s=!n.settings[t],n.settings[t]=s,e.classList.toggle('active',s),i.p=1,i.n=2,chrome.runtime.sendMessage({ action:'updateSettings',data:r({},t,s) });case 2:i.n=4;break;case 3:i.p=3,a=i.v,console.error('‚ùå Error updating '.concat(t,':'),a);case 4:return i.a(2);}},o,null,[[1,3]]);})));} },{ key:'saveSettings',value:(u=a(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return console.log('üíæ Saving settings...'),e.p=1,e.n=2,chrome.runtime.sendMessage({ action:'updateSettings',data:this.settings });case 2:this.showSuccess('Settings saved successfully!'),e.n=4;break;case 3:e.p=3,t=e.v,console.error('‚ùå Error saving settings:',t),this.showError('Failed to save settings');case 4:return e.a(2);}},e,this,[[1,3]]);})),function(){return u.apply(this,arguments);}) },{ key:'openOptions',value:(s=a(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.runtime.openOptionsPage();case 1:window.close(),e.n=3;break;case 2:e.p=2,t=e.v,console.error('‚ùå Error opening options page:',t),this.showError('Could not open options page');case 3:return e.a(2);}},e,this,[[0,2]]);})),function(){return s.apply(this,arguments);}) },{ key:'startMonitoring',value:(o=a(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return console.log('üîç Starting monitoring...'),e.p=1,e.n=2,chrome.runtime.sendMessage({ action:'startMonitoring' });case 2:this.updateStatus('Monitoring','active'),e.n=4;break;case 3:e.p=3,t=e.v,console.error('‚ùå Error starting monitoring:',t),this.showError('Failed to start monitoring');case 4:return e.a(2);}},e,this,[[1,3]]);})),function(){return o.apply(this,arguments);}) },{ key:'updateUI',value:function(){var e=document.getElementById('instructor-setup'),t=document.getElementById('pupils-section'),n=document.getElementById('statistics-section'),r=document.getElementById('settings-section');if(this.currentInstructor){e&&(e.style.display='none'),t&&(t.style.display='block'),n&&(n.style.display='block'),r&&(r.style.display='block'),this.renderPupilsList(),this.updateStatistics();var i=document.getElementById('adi-number'),o=document.getElementById('base-location'),s=document.getElementById('travel-radius');i&&(i.value=this.currentInstructor.adiNumber),o&&(o.value=this.currentInstructor.baseLocation.city),s&&(s.value=this.currentInstructor.travelRadius);}else e&&(instructorSection.style.display='block'),t&&(t.style.display='none'),n&&(n.style.display='none'),r&&(r.style.display='none');this.setupSettingsToggles();} },{ key:'updateStatistics',value:function(){var e=document.getElementById('total-checks'),t=document.getElementById('successful-changes'),n=document.getElementById('success-rate');e&&(e.textContent='0'),t&&(t.textContent='0'),n&&(n.textContent='0%');} },{ key:'setupInputValidation',value:function(){var e=document.getElementById('adi-number');e&&e.addEventListener('input',function(e){e.target.value=e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,'');});var t=document.getElementById('new-pupil-licence');t&&t.addEventListener('input',function(e){e.target.value=e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,'');});} },{ key:'showLoading',value:function(e){console.log('‚è≥ Loading:',e);} },{ key:'hideLoading',value:function(){console.log('‚úÖ Loading complete');} },{ key:'showSuccess',value:function(e){console.log('‚úÖ Success:',e);} },{ key:'showError',value:function(e){console.error('‚ùå Error:',e);} }],t&&c(e.prototype,t),Object.defineProperty(e,'prototype',{ writable:!1 }),e;var e,t,o,s,u,l,p,d,f,h,g;}();document.addEventListener('DOMContentLoaded',a(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.n){case 0:return console.log('üöÄ Popup DOM loaded'),t=new l,e.n=1,t.initialize();case 1:console.log('‚úÖ Popup fully initialized');case 2:return e.a(2);}},e);})));})();

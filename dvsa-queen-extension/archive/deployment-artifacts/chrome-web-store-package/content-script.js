/*! For license information please see content-script.js.LICENSE.txt */
(()=>{function n(e){return n='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(n){return typeof n;}:function(n){return n&&'function'==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?'symbol':typeof n;},n(e);}function e(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable;})),t.push.apply(t,i);}return t;}function t(n){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?e(Object(a),!0).forEach(function(e){i(n,e,a[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e));});}return n;}function i(n,e,t){return(e=l(e))in n?Object.defineProperty(n,e,{ value:t,enumerable:!0,configurable:!0,writable:!0 }):n[e]=t,n;}function a(){var n,e,t='function'==typeof Symbol?Symbol:{},i=t.iterator||'@@iterator',s=t.toStringTag||'@@toStringTag';function o(t,i,a,s){var o=i&&i.prototype instanceof l?i:l,u=Object.create(o.prototype);return r(u,'_invoke',function(t,i,a){var r,s,o,l=0,u=a||[],d=!1,h={ p:0,n:0,v:n,a:p,f:p.bind(n,4),d:function(e,t){return r=e,s=0,o=n,h.n=t,c;} };function p(t,i){for(s=t,o=i,e=0;!d&&l&&!a&&e<u.length;e++){var a,r=u[e],p=h.p,f=r[2];t>3?(a=f===i)&&(o=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=n):r[0]<=p&&((a=t<2&&p<r[1])?(s=0,h.v=i,h.n=r[1]):p<f&&(a=t<3||r[0]>i||i>f)&&(r[4]=t,r[5]=i,h.n=f,s=0));}if(a||t>1)return c;throw d=!0,i;}return function(a,u,f){if(l>1)throw TypeError('Generator is already running');for(d&&1===u&&p(u,f),s=u,o=f;(e=s<2?n:o)||!d;){r||(s?s<3?(s>1&&(h.n=-1),p(s,o)):h.n=o:h.v=o);try{if(l=2,r){if(s||(a='next'),e=r[a]){if(!(e=e.call(r,o)))throw TypeError('iterator result is not an object');if(!e.done)return e;o=e.value,s<2&&(s=0);}else 1===s&&(e=r.return)&&e.call(r),s<2&&(o=TypeError('The iterator does not provide a \''+a+'\' method'),s=1);r=n;}else if((e=(d=h.n<0)?o:t.call(i,h))!==c)break;}catch(e){r=n,s=1,o=e;}finally{l=1;}}return{ value:e,done:d };};}(t,a,s),!0),u;}var c={};function l(){}function u(){}function d(){}e=Object.getPrototypeOf;var h=[][i]?e(e([][i]())):(r(e={},i,function(){return this;}),e),p=d.prototype=l.prototype=Object.create(h);function f(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,d):(n.__proto__=d,r(n,s,'GeneratorFunction')),n.prototype=Object.create(p),n;}return u.prototype=d,r(p,'constructor',d),r(d,'constructor',u),u.displayName='GeneratorFunction',r(d,s,'GeneratorFunction'),r(p),r(p,s,'Generator'),r(p,i,function(){return this;}),r(p,'toString',function(){return'[object Generator]';}),(a=function(){return{ w:o,m:f };})();}function r(n,e,t,i){var a=Object.defineProperty;try{a({},'',{});}catch(n){a=0;}r=function(n,e,t,i){function s(e,t){r(n,e,function(n){return this._invoke(e,t,n);});}e?a?a(n,e,{ value:t,enumerable:!i,configurable:!i,writable:!i }):n[e]=t:(s('next',0),s('throw',1),s('return',2));},r(n,e,t,i);}function s(n,e,t,i,a,r,s){try{var o=n[r](s),c=o.value;}catch(n){return void t(n);}o.done?e(c):Promise.resolve(c).then(i,a);}function o(n){return function(){var e=this,t=arguments;return new Promise(function(i,a){var r=n.apply(e,t);function o(n){s(r,i,a,o,c,'next',n);}function c(n){s(r,i,a,o,c,'throw',n);}o(void 0);});};}function c(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(n,l(i.key),i);}}function l(e){var t=function(e){if('object'!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,'string');if('object'!=n(i))return i;throw new TypeError('@@toPrimitive must return a primitive value.');}return String(e);}(e);return'symbol'==n(t)?t:t+'';}var u=function(){return n=function n(){!function(n,e){if(!(n instanceof e))throw new TypeError('Cannot call a class as a function');}(this,n),this.isActive=!1,this.currentInstructor=null,this.pupils=[],this.settings={ autoCheck:!0,checkInterval:15e3,soundEnabled:!0,notifications:!0,stealthLevel:'HIGH' },this.stealthManager=null,this.sessionData={ startTime:Date.now(),totalOperations:0,successfulOperations:0,detectionRisk:'LOW' };},e=[{ key:'initialize',value:(f=o(a().m(function n(){var e;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:if(console.log('üöÄ DVSA Queen - Advanced Stealth Mode Initializing...'),'loading'!==document.readyState){n.n=1;break;}return n.n=1,new Promise(function(n){return document.addEventListener('DOMContentLoaded',n);});case 1:if(this.isDVSAChangePage()){n.n=2;break;}return console.log('‚ö†Ô∏è Not on DVSA change page, extension inactive'),n.a(2);case 2:return console.log('‚úÖ DVSA change page detected, initializing advanced stealth systems'),n.p=3,this.stealthManager=new StealthManager,n.n=4,this.stealthManager.initialize();case 4:return n.n=5,this.loadConfiguration();case 5:if(this.injectAdvancedInterface(),this.setupAdvancedEventListeners(),!this.settings.autoCheck){n.n=6;break;}return n.n=6,this.startStealthMonitoring();case 6:this.isActive=!0,console.log('‚úÖ DVSA Queen - Advanced Stealth Mode Fully Activated'),n.n=8;break;case 7:n.p=7,e=n.v,console.error('‚ùå Advanced stealth initialization failed:',e),this.handleInitializationError(e);case 8:return n.a(2);}},n,this,[[3,7]]);})),function(){return f.apply(this,arguments);}) },{ key:'isDVSAChangePage',value:function(){var n=window.location.href;return n.includes('driverpracticaltest.dvsa.gov.uk')&&(n.includes('change')||n.includes('manage')||n.includes('reschedule')||n.includes('available')||n.includes('booking'));} },{ key:'loadConfiguration',value:(p=o(a().m(function n(){var e,i,r;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,chrome.runtime.sendMessage({ action:'getFullState' });case 1:(e=n.v).success&&(this.currentInstructor=e.state.currentInstructor,this.pupils=e.state.pupils||[],this.settings=t(t({},this.settings),e.state.settings),console.log('‚úÖ Configuration loaded:',{ instructor:null===(i=this.currentInstructor)||void 0===i?void 0:i.adiNumber,pupils:this.pupils.length,settings:this.settings })),n.n=3;break;case 2:throw n.p=2,r=n.v,console.error('‚ùå Configuration load failed:',r),r;case 3:return n.a(2);}},n,this,[[0,2]]);})),function(){return p.apply(this,arguments);}) },{ key:'injectAdvancedInterface',value:function(){var n=document.getElementById('dvsa-queen-panel');n&&n.remove();var e=document.createElement('div');e.id='dvsa-queen-panel',e.className='stealth-mode',e.innerHTML=this.getAdvancedInterfaceHTML();var t=document.createElement('style');t.textContent=this.getAdvancedStyles(),document.head.appendChild(t),document.body.appendChild(e),this.setupInterfaceEventListeners(e),console.log('üé® Advanced stealth interface injected');} },{ key:'getAdvancedInterfaceHTML',value:function(){return'\n      <div class="dvsa-queen-header">\n        <div class="header-left">\n          <span class="stealth-indicator" title="Stealth Level: '.concat(this.settings.stealthLevel,'"></span>\n          <span class="dvsa-queen-title">DVSA Queen Pro</span>\n        </div>\n        <div class="header-right">\n          <button class="minimize-btn" title="Minimize">‚àí</button>\n          <button class="close-btn" title="Close">√ó</button>\n        </div>\n      </div>\n\n      <div class="dvsa-queen-content">\n        <div class="stealth-status-bar">\n          <div class="status-item">\n            <span class="status-label">Status:</span>\n            <span class="status-value" id="status-text">Ready</span>\n          </div>\n          <div class="status-item">\n            <span class="status-label">Risk:</span>\n            <span class="risk-indicator" id="risk-level">LOW</span>\n          </div>\n          <div class="status-item">\n            <span class="status-label">Ops:</span>\n            <span class="ops-counter" id="ops-count">0</span>\n          </div>\n        </div>\n\n        <div class="instructor-info" id="instructor-info">\n          <div class="info-row">\n            <span class="info-label">ADI:</span>\n            <span class="info-value" id="adi-number">Not Set</span>\n          </div>\n          <div class="info-row">\n            <span class="info-label">Pupils:</span>\n            <span class="info-value" id="pupil-count">0</span>\n          </div>\n        </div>\n\n        <div class="advanced-controls">\n          <button class="primary-btn" id="stealth-check-btn">\n            <span class="btn-icon">üîç</span>\n            Stealth Check\n          </button>\n          <button class="secondary-btn" id="emergency-stop-btn">\n            <span class="btn-icon">üõë</span>\n            Emergency Stop\n          </button>\n        </div>\n\n        <div class="stealth-metrics">\n          <div class="metric-row">\n            <span class="metric-label">Detection Risk:</span>\n            <span class="metric-value" id="detection-risk">Low</span>\n          </div>\n          <div class="metric-row">\n            <span class="metric-label">Success Rate:</span>\n            <span class="metric-value" id="success-rate">0%</span>\n          </div>\n          <div class="metric-row">\n            <span class="metric-label">Last Check:</span>\n            <span class="metric-value" id="last-check">Never</span>\n          </div>\n        </div>\n\n        <div class="stealth-activity">\n          <div class="activity-title">Recent Activity</div>\n          <div class="activity-log" id="activity-log">\n            <div class="activity-item">System initialized</div>\n          </div>\n        </div>\n      </div>\n    ');} },{ key:'getAdvancedStyles',value:function(){return'\n      #dvsa-queen-panel {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        width: 320px;\n        background: linear-gradient(135deg, #1a1a2e, #16213e);\n        border: 2px solid #0f3460;\n        border-radius: 12px;\n        box-shadow: 0 8px 32px rgba(0,0,0,0.3);\n        font-family: \'Segoe UI\', Tahoma, Geneva, Verdana, sans-serif;\n        font-size: 13px;\n        z-index: 10000;\n        transition: all 0.3s ease;\n        backdrop-filter: blur(10px);\n      }\n\n      #dvsa-queen-panel.minimized {\n        width: 80px;\n        height: 50px;\n        overflow: hidden;\n      }\n\n      .dvsa-queen-header {\n        background: linear-gradient(90deg, #0f3460, #1d70b8);\n        color: white;\n        padding: 12px 16px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        border-radius: 10px 10px 0 0;\n        cursor: move;\n      }\n\n      .header-left, .header-right {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .stealth-indicator {\n        width: 8px;\n        height: 8px;\n        border-radius: 50%;\n        background: #00ff88;\n        box-shadow: 0 0 10px #00ff88;\n        animation: pulse 2s infinite;\n      }\n\n      @keyframes pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n      }\n\n      .dvsa-queen-title {\n        font-weight: 600;\n        font-size: 16px;\n        letter-spacing: 0.5px;\n      }\n\n      .minimize-btn, .close-btn {\n        background: rgba(255,255,255,0.2);\n        border: none;\n        color: white;\n        width: 24px;\n        height: 24px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 16px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s ease;\n      }\n\n      .minimize-btn:hover, .close-btn:hover {\n        background: rgba(255,255,255,0.3);\n        transform: scale(1.1);\n      }\n\n      .dvsa-queen-content {\n        padding: 16px;\n        color: #e0e6ed;\n      }\n\n      .stealth-status-bar {\n        display: grid;\n        grid-template-columns: 1fr 1fr 1fr;\n        gap: 8px;\n        margin-bottom: 16px;\n        padding: 12px;\n        background: rgba(255,255,255,0.05);\n        border-radius: 8px;\n      }\n\n      .status-item {\n        text-align: center;\n      }\n\n      .status-label {\n        display: block;\n        font-size: 10px;\n        color: #a0a6ad;\n        margin-bottom: 4px;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n\n      .status-value, .risk-indicator, .ops-counter {\n        display: block;\n        font-weight: 600;\n        font-size: 12px;\n      }\n\n      .risk-indicator.LOW { color: #00ff88; }\n      .risk-indicator.MEDIUM { color: #ffaa00; }\n      .risk-indicator.HIGH { color: #ff4444; }\n\n      .instructor-info {\n        margin-bottom: 16px;\n        padding: 12px;\n        background: rgba(255,255,255,0.05);\n        border-radius: 8px;\n      }\n\n      .info-row {\n        display: flex;\n        justify-content: space-between;\n        margin-bottom: 4px;\n      }\n\n      .info-row:last-child {\n        margin-bottom: 0;\n      }\n\n      .info-label {\n        color: #a0a6ad;\n        font-size: 11px;\n      }\n\n      .info-value {\n        color: #ffffff;\n        font-weight: 500;\n        font-size: 11px;\n      }\n\n      .advanced-controls {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 8px;\n        margin-bottom: 16px;\n      }\n\n      .primary-btn, .secondary-btn {\n        padding: 10px 12px;\n        border: none;\n        border-radius: 6px;\n        font-size: 12px;\n        font-weight: 600;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 6px;\n        transition: all 0.2s ease;\n      }\n\n      .primary-btn {\n        background: linear-gradient(135deg, #00ff88, #00cc6a);\n        color: #0a0a0a;\n      }\n\n      .primary-btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 4px 12px rgba(0,255,136,0.3);\n      }\n\n      .secondary-btn {\n        background: rgba(255,255,255,0.1);\n        color: #e0e6ed;\n        border: 1px solid rgba(255,255,255,0.2);\n      }\n\n      .secondary-btn:hover {\n        background: rgba(255,255,255,0.2);\n      }\n\n      .btn-icon {\n        font-size: 14px;\n      }\n\n      .stealth-metrics {\n        margin-bottom: 16px;\n      }\n\n      .metric-row {\n        display: flex;\n        justify-content: space-between;\n        margin-bottom: 6px;\n        padding: 4px 0;\n      }\n\n      .metric-label {\n        color: #a0a6ad;\n        font-size: 11px;\n      }\n\n      .metric-value {\n        color: #ffffff;\n        font-weight: 500;\n        font-size: 11px;\n      }\n\n      .stealth-activity {\n        border-top: 1px solid rgba(255,255,255,0.1);\n        padding-top: 12px;\n      }\n\n      .activity-title {\n        color: #a0a6ad;\n        font-size: 11px;\n        margin-bottom: 8px;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n\n      .activity-log {\n        max-height: 80px;\n        overflow-y: auto;\n      }\n\n      .activity-item {\n        font-size: 10px;\n        color: #c0c6cd;\n        margin-bottom: 4px;\n        padding: 2px 0;\n        border-left: 2px solid #1d70b8;\n        padding-left: 8px;\n      }\n\n      .activity-item.success {\n        border-left-color: #00ff88;\n      }\n\n      .activity-item.warning {\n        border-left-color: #ffaa00;\n      }\n\n      .activity-item.error {\n        border-left-color: #ff4444;\n      }\n\n      /* Scrollbar styling */\n      .activity-log::-webkit-scrollbar {\n        width: 4px;\n      }\n\n      .activity-log::-webkit-scrollbar-track {\n        background: rgba(255,255,255,0.05);\n        border-radius: 2px;\n      }\n\n      .activity-log::-webkit-scrollbar-thumb {\n        background: rgba(255,255,255,0.2);\n        border-radius: 2px;\n      }\n\n      .activity-log::-webkit-scrollbar-thumb:hover {\n        background: rgba(255,255,255,0.3);\n      }\n    ';} },{ key:'setupInterfaceEventListeners',value:function(n){var e=this;n.querySelector('#stealth-check-btn').addEventListener('click',o(a().m(function n(){return a().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,e.performStealthCheck();case 1:return n.a(2);}},n);}))),n.querySelector('#emergency-stop-btn').addEventListener('click',function(){e.emergencyStop();}),n.querySelector('.minimize-btn').addEventListener('click',function(){n.classList.toggle('minimized');}),n.querySelector('.close-btn').addEventListener('click',function(){n.style.display='none';}),this.makePanelDraggable(n);} },{ key:'setupAdvancedEventListeners',value:function(){var n=this;chrome.runtime.onMessage.addListener(function(e,t,i){return n.handleAdvancedMessage(e,t,i),!0;}),this.setupNavigationMonitoring(),document.addEventListener('visibilitychange',function(){n.handleVisibilityChange();});} },{ key:'handleAdvancedMessage',value:(h=o(a().m(function n(e,t,i){var r,s,o,c;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:console.log('üì® Advanced message received:',e.action),n.p=1,o=e.action,n.n='performStealthCheck'===o?2:'getStealthStatus'===o?4:'updateSettings'===o?5:'emergencyStop'===o?7:8;break;case 2:return n.n=3,this.performStealthCheck();case 3:return r=n.v,i({ success:!0,result:r }),n.a(3,9);case 4:return s=this.getStealthStatus(),i({ success:!0,status:s }),n.a(3,9);case 5:return n.n=6,this.updateStealthSettings(e.settings);case 6:return i({ success:!0 }),n.a(3,9);case 7:return this.emergencyStop(),i({ success:!0 }),n.a(3,9);case 8:i({ success:!1,error:'Unknown action' });case 9:n.n=11;break;case 10:n.p=10,c=n.v,console.error('‚ùå Message handling error:',c),i({ success:!1,error:c.message });case 11:return n.a(2);}},n,this,[[1,10]]);})),function(n,e,t){return h.apply(this,arguments);}) },{ key:'performStealthCheck',value:(d=o(a().m(function n(){var e,t,i=this;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:if(console.log('üîç Performing stealth check...'),this.stealthManager){n.n=1;break;}throw new Error('Stealth Manager not initialized');case 1:return this.updateInterfaceStatus('Checking...','warning'),this.addActivityLog('Starting stealth check','info'),n.p=2,n.n=3,this.stealthManager.executeStealthOperation('checkAvailability',o(a().m(function n(){return a().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,i.checkForAvailableSlots();case 1:return n.a(2,n.v);}},n);})),{ operationContext:'cancellation_check',instructor:this.currentInstructor,pupils:this.pupils.length });case 3:return(e=n.v).success?this.handleSuccessfulCheck(e):this.handleFailedCheck(e),n.a(2,e);case 4:throw n.p=4,t=n.v,console.error('‚ùå Stealth check failed:',t),this.addActivityLog('Stealth check failed: '+t.message,'error'),t;case 5:return n.a(2);}},n,this,[[2,4]]);})),function(){return d.apply(this,arguments);}) },{ key:'checkForAvailableSlots',value:(u=o(a().m(function n(){var e,t=this;return a().w(function(n){for(;;)switch(n.n){case 0:return console.log('üîç Checking for available DVSA slots...'),n.n=1,this.simulateRealisticPageInteraction();case 1:return e=[{ date:'2024-12-15',centre:'LONDON-WD',time:'09:00',type:'cancellation' },{ date:'2024-12-18',centre:'LONDON-WG',time:'14:30',type:'new' },{ date:'2024-12-20',centre:'BIRMINGHAM',time:'11:00',type:'cancellation' }],n.a(2,e.filter(function(n){return t.matchesPupilPreferences(n);}));}},n,this);})),function(){return u.apply(this,arguments);}) },{ key:'simulateRealisticPageInteraction',value:(l=o(a().m(function n(){var e;return a().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,this.stealthManager.timingRandomizer.simulateThinking('normal');case 1:if(!(e=document.querySelector('.calendar, .booking-calendar, [data-testid="calendar"]'))){n.n=2;break;}return n.n=2,this.stealthManager.mouseSimulator.simulateNaturalMovement(e);case 2:return n.n=3,this.stealthManager.timingRandomizer.simulateReadingTime(document.body,{ includeScroll:!0 });case 3:return n.a(2);}},n,this);})),function(){return l.apply(this,arguments);}) },{ key:'updateInterfaceStatus',value:function(n){var e=document.getElementById('status-text'),t=document.getElementById('risk-level');e&&(e.textContent=n),t&&(t.textContent=this.sessionData.detectionRisk,t.className='risk-indicator '+this.sessionData.detectionRisk);var i=document.getElementById('ops-count');i&&(i.textContent=this.sessionData.totalOperations);} },{ key:'addActivityLog',value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'info',t=document.getElementById('activity-log');if(t){var i=document.createElement('div');for(i.className='activity-item '.concat(e),i.textContent='['.concat((new Date).toLocaleTimeString(),'] ').concat(n),t.insertBefore(i,t.firstChild);t.children.length>10;)t.removeChild(t.lastChild);}} },{ key:'getStealthStatus',value:function(){if(!this.stealthManager)return{ active:!1,error:'Not initialized' };var n=this.stealthManager.getStealthStatistics();return{ active:this.isActive,stealthLevel:this.settings.stealthLevel,sessionAge:n.sessionAge,totalOperations:n.totalOperations,successRate:n.successRate,detectionRisk:n.currentRiskLevel,emergencyActivations:n.emergencyActivations };} },{ key:'startStealthMonitoring',value:(s=o(a().m(function n(){var e,t=this;return a().w(function(n){for(;;)switch(n.n){case 0:if(console.log('üîç Starting stealth monitoring...'),this.stealthManager){n.n=1;break;}throw new Error('Stealth Manager not initialized');case 1:e=this.stealthManager.timingRandomizer.calculateAdaptiveCheckInterval({ context:'monitoring',successRate:this.sessionData.successfulOperations/Math.max(1,this.sessionData.totalOperations) }),console.log('‚è±Ô∏è Adaptive monitoring interval: '.concat(e,'ms')),this.monitoringInterval=setInterval(o(a().m(function n(){return a().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,t.performStealthCheck();case 1:return n.a(2);}},n);})),e),this.addActivityLog('Stealth monitoring started','success');case 2:return n.a(2);}},n,this);})),function(){return s.apply(this,arguments);}) },{ key:'emergencyStop',value:function(){console.log('üõë Emergency stop activated'),this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null),this.updateInterfaceStatus('EMERGENCY STOP','error'),this.addActivityLog('EMERGENCY STOP ACTIVATED','error'),chrome.runtime.sendMessage({ action:'emergencyStop',data:{ timestamp:Date.now(),reason:'User emergency stop' } });} },{ key:'handleSuccessfulCheck',value:function(n){console.log('‚úÖ Stealth check successful:',n),this.sessionData.successfulOperations++,this.sessionData.totalOperations++,this.sessionData.detectionRisk=n.riskLevel,this.updateInterfaceStatus('Check Complete','active'),this.addActivityLog('Check completed - Risk: '.concat(n.riskLevel),'success'),n.result&&n.result.length>0&&this.handleFoundSlots(n.result);} },{ key:'handleFailedCheck',value:function(n){console.log('‚ùå Stealth check failed:',n),this.sessionData.totalOperations++,this.sessionData.detectionRisk=n.riskLevel||'HIGH',this.updateInterfaceStatus('Check Failed','error'),this.addActivityLog('Check failed - Risk: '.concat(n.riskLevel),'error'),n.blocked&&this.addActivityLog('Operation blocked due to high risk','warning');} },{ key:'handleFoundSlots',value:(r=o(a().m(function n(e){return a().w(function(n){for(;;)switch(n.n){case 0:return console.log('üéØ Found available slots:',e),this.addActivityLog('Found '.concat(e.length,' available slots'),'success'),n.n=1,chrome.runtime.sendMessage({ action:'foundCancellation',data:{ slots:e,timestamp:Date.now(),instructor:this.currentInstructor,pupils:this.pupils.length } });case 1:this.highlightAvailableSlots(e);case 2:return n.a(2);}},n,this);})),function(n){return r.apply(this,arguments);}) },{ key:'makePanelDraggable',value:function(n){var e,t,i,a,r=!1,s=0,o=0,c=n.querySelector('.dvsa-queen-header');c.addEventListener('mousedown',function(n){i=n.clientX-s,a=n.clientY-o,(n.target===c||c.contains(n.target))&&(r=!0);}),document.addEventListener('mousemove',function(c){r&&(c.preventDefault(),e=c.clientX-i,t=c.clientY-a,s=e,o=t,n.style.transform='translate('.concat(e,'px, ').concat(t,'px)'));}),document.addEventListener('mouseup',function(n){i=e,a=t,r=!1;});} },{ key:'setupNavigationMonitoring',value:function(){var n=this,e=location.href;new MutationObserver(function(){var t=location.href;t!==e&&(e=t,n.handleUrlChange(t));}).observe(document,{ subtree:!0,childList:!0 });} },{ key:'handleUrlChange',value:(i=o(a().m(function n(e){return a().w(function(n){for(;;)switch(n.n){case 0:console.log('üîÑ URL changed:',e),this.isDVSAChangePage()?this.updateInterfaceStatus('Active','active'):(this.updateInterfaceStatus('Inactive','inactive'),this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null));case 1:return n.a(2);}},n,this);})),function(n){return i.apply(this,arguments);}) },{ key:'handleVisibilityChange',value:function(){document.hidden?console.log('üìã Page hidden - pausing operations'):console.log('üìã Page visible - resuming operations');} },{ key:'handleInitializationError',value:function(n){console.error('‚ùå Initialization error:',n),this.addActivityLog('Initialization failed: '+n.message,'error'),chrome.runtime.sendMessage({ action:'initializationError',data:{ error:n.message,timestamp:Date.now(),url:window.location.href } });} },{ key:'updateStealthSettings',value:function(n){this.settings=t(t({},this.settings),n),console.log('‚öôÔ∏è Stealth settings updated:',this.settings);} },{ key:'matchesPupilPreferences',value:function(n){return!0;} },{ key:'highlightAvailableSlots',value:function(n){console.log('üé® Highlighting slots:',n);} }],e&&c(n.prototype,e),Object.defineProperty(n,'prototype',{ writable:!1 }),n;var n,e,i,r,s,l,u,d,h,p,f;}();!function(){'use strict';function n(){return e.apply(this,arguments);}function e(){return(e=o(a().m(function n(){var e,t;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:return console.log('üöÄ Initializing DVSA Queen Advanced Stealth System'),n.p=1,e=new u,n.n=2,e.initialize();case 2:window.dvsaQueen=e,console.log('‚úÖ DVSA Queen Advanced Stealth System Fully Activated'),n.n=4;break;case 3:n.p=3,t=n.v,console.error('‚ùå Advanced stealth initialization failed:',t);case 4:return n.a(2);}},n,null,[[1,3]]);}))).apply(this,arguments);}window.location.href.includes('driverpracticaltest.dvsa.gov.uk')&&('loading'===document.readyState?document.addEventListener('DOMContentLoaded',n):n());}();})();
